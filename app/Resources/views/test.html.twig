{% extends 'base.html.twig' %}

{% block body %}

    <script>
        var path = 'wss://stream3.forexpros.com/echo/102/k49xncyp/websocket';
///
//        var path = 'wss://stream10.forexpros.com/echo/4/tttt33tt/websocket';

        var ws = new WebSocket(path);
        var events = [
            'pid-1',
            'pid-2',
            'pid-3',
            'pid-4',
            'pid-5',
            'pid-7',
            'pid-8',
            'pid-17',
            'pid-18',
            'pid-21',
            'pid-39',
            'pid-40',
            'pid-41',
            'pid-42',
            'pid-43',
            'pid-59',
            'pid-63',
            'pid-68',
            'pid-69',
            'pid-91',
            'pid-103',
            'pid-147',
            'pid-152',
            'pid-153',
            'pid-154',
            'pid-155',
            'pid-157',
            'pid-160',
            'pid-650',
            'pid-1516',
            'pid-1538',
            'pid-1560',
            'pid-1726',
            'pid-1809',
            'pid-1910',
            'pid-1932',
            'pid-2044',
            'pid-2086',
            'pid-2087',
            'pid-2088',
            'pid-2090',
            'pid-2091',
            'pid-2095',
            'pid-2096',
            'pid-2097',
            'pid-2098',
            'pid-2099',
            'pid-2101',
            'pid-2102',
            'pid-2103',
            'pid-2104',
            'pid-2106',
            'pid-2108',
            'pid-2110',
            'pid-2111',
            'pid-2112',
            'pid-2113',
            'pid-2114',
            'pid-2117',
            'pid-2118',
            'pid-2119',
            'pid-2122',
            'pid-2123',
            'pid-2124',
            'pid-2125',
            'pid-2126',
            'pid-2127',
            'pid-2129',
            'pid-2131',
            'pid-2132',
            'pid-2133',
            'pid-2135',
            'pid-2136',
            'pid-2137',
            'pid-2138',
            'pid-2139',
            'pid-2140',
            'pid-2141',
            'pid-2142',
            'pid-2143',
            'pid-2145',
            'pid-2146',
            'pid-2148',
            'pid-2149',
            'pid-2150',
            'pid-2151',
            'pid-2152',
            'pid-2155',
            'pid-2156',
            'pid-2157',
            'pid-2158',
            'pid-2160',
            'pid-2161',
            'pid-2162',
            'pid-2163',
            'pid-2165',
            'pid-2166',
            'pid-2167',
            'pid-2168',
            'pid-2170',
            'pid-2171',
            'pid-2172',
            'pid-2173',
            'pid-2174',
            'pid-2175',
            'pid-2176',
            'pid-2177',
            'pid-2178',
            'pid-2179',
            'pid-2180',
            'pid-2181',
            'pid-2182',
            'pid-2184',
            'pid-2185',
            'pid-2186',
            'pid-2187',
            'pid-2189',
            'pid-2191',
            'pid-2195',
            'pid-2198',
            'pid-2199',
            'pid-2200',
            'pid-2201',
            'pid-2203',
            'pid-2205',
            'pid-2206',
            'pid-2207',
            'pid-2208',
            'pid-2209',
            'pid-2210',
            'pid-2211',
            'pid-2213',
            'pid-2214',
            'pid-2215',
            'pid-2217',
            'pid-2218',
            'pid-2220',
            'pid-2221',
            'pid-2222',
            'pid-2224',
            'pid-9304',
            'pid-9357',
            'pid-9536',
            'pid-9604',
            'pid-9651',
            'pid-9723',
            'pid-9831',
            'pid-9882',
            'pid-10018',
            'pid-10064',
            'pid-10119',
            'pid-10168',
            'pid-10290',
            'pid-10339',
            'pid-10397',
            'pid-10441',
            'pid-11756',
            'pid-11757',
            'pid-11758',
            'pid-11759',
            'pid-11760',
            'pid-11761',
            'pid-11762',
            'pid-13922',
            'pid-14478',
            'pid-49798',
            'pid-49799',
            'pid-50654',
            'pid-53073',
            'pid-53080',
            'pid-53082',
            'pid-53085',
            'pid-940811',
            'pid-941146',
            'pid-941148',
            'pid-945629',
            'pid-945630',
            'pid-950989',
            'pid-950994',
            'pid-950996',
            'pid-961728',
            'pid-962660',
            'pid-962663',
            'pid-962711',
            'pid-993162',
            'pid-993164',
            'pid-993166',
            'pid-993168',
            'pid-993169',
            'pid-997650',
            'pid-997651',
            'pid-1010774',
            'pid-1010780',
            'pid-1010781',
            'pid-1010782',
            'pid-1010784',
            'pid-1010785',
            'pid-1010789',
            'pid-1010793',
            'pid-1010796',
            'pid-1010797',
            'pid-1010798',
            'pid-1010805',
            'pid-1010807',
            'pid-1010883',
            'pid-1014016',
            'pid-1014071',
            'pid-1014072',
            'pid-1024815',
            'pid-1024818',
            'pid-1024821',
            'pid-1024870',
            'pid-1025083',
            'pid-1029164',
            'pid-1029169',
            'pid-1029170',
            'pid-1029175',
            'pid-1029179',
            'pid-1031043',
            'pid-1031044',
            'pid-1031047',
            'pid-1031048',
            'pid-1031054',
            'pid-1031056',
            'pid-1031059',
            'pid-1031061',
            'pid-1031062',
            'pid-1031063',
            'pid-1031068',
            'pid-1031081',
            'pid-1031289',
            'pid-1031327',
            'pid-1031333',
            'pid-1031395',
            'pid-1031397',
            'pid-1031677',
            'pid-1031681',
            'pid-1031685',
            'pid-1031688',
            'pid-1031703',
            'pid-1031704',
            'pid-1031706',
            'pid-1031707',
            'pid-1031708',
            'pid-1031710',
            'pid-1031712',
            'pid-1031714',
            'pid-1031729',
            'pid-1031856',
            'pid-1034500',
            'pid-1034511',
            'pid-1035789',
            'pid-1035793',
            'pid-1035794',
            'pid-1035797',
            'pid-1035799',
            'pid-1035801',
            'pid-1035804',
            'pid-1036862',
            'pid-1036878',
            'pid-1036955',
            'pid-1036958',
            'pid-1036961',
            'pid-1036964',
            'pid-1036969',
            'pid-1036970',
            'pid-1036973',
            'pid-1037006',
            'pid-1037013',
            'pid-1037014',
            'pid-1037022',
            'pid-1037023',
            'pid-1037024',
            'pid-1037025',
            'pid-1037026',
            'pid-1037027',
            'pid-1037028',
            'pid-1037029',
            'pid-1037030',
            'pid-1037031',
            'pid-1037032',
            'pid-1037033',
            'pid-1037034',
            'pid-1037035',
            'pid-1037036',
            'pid-1037037',
            'pid-1037038',
            'pid-1037039',
            'pid-1037040',
            'pid-1037041',
            'pid-1037042',
            'pid-1037043',
            'pid-1037044',
            'pid-1037045',
            'pid-1037046',
            'pid-1037047',
            'pid-1037048',
            'pid-1037049',
            'pid-1043107',
            'pid-1043108',
            'pid-1043109',
            'pid-1050048',
            'pid-8839',
            'pid-8874',
            'pid-169',
            'pid-170',
            'pid-44336',
            'pid-172',
            'pid-178',
            'pid-8827',
            'pid-9',
            'pid-10',
            'pidTechSumm-1',
            'pidTechSumm-2',
            'pidTechSumm-3',
            'pidTechSumm-5',
            'pidTechSumm-7',
            'pidTechSumm-9',
            'pidTechSumm-10',
            'isOpenExch-1',
            'isOpenExch-13',
            'isOpenExch-4',
            'isOpenExch-20',
            'isOpenPair-8839',
            'isOpenPair-8874',
            'isOpenPair-44336',
            'isOpenPair-8827',
            'domain-1',
            'sendUID-0'
        ];

        ws.onmessage = function (message) {
            if (message.data === 'o') {
                for (var i = 0; i < events.length; i++) {
                    ws.send('["{\\"_event\\":\\"subscribe\\",\\"tzID\\":55,\\"message\\":\\"' + events[i] + ':\\"}"]');
                }
            }

            var jsonMessage = JSON.parse(JSON.parse(message.data.substring(1))[0]);
            if (typeof jsonMessage !== "undefined" && jsonMessage.message !== "undefined" && typeof jsonMessage.message === "string") {
                try {
                    var data = jsonMessage.message.split('::');
                    var dataType = data[0];
                    var dataContent = JSON.parse(data[1]);
                    if (dataContent.pid == '2') {
                        console.log('bid', dataContent.bid, 'ask', dataContent.ask, dataType);
                    }
                } catch (e) {
                    console.error(e);
                }
            }
        };

        ws.onopen = function () {
            window.setInterval(function () {
                this.send('["{\\"_event\\":\\"heartbeat\\",\\"data\\":\\"h\\"}"]');
                console.log('sending hearbeat')
            }.bind(ws), 10000);
        };

    </script>

{% endblock %}

{% block stylesheets %}

{% endblock %}

